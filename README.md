# Пояснения к выполнению работы по написанию сервера на Erlang
##### Передварительная подготовка:
Для запуска кода, находящегося в этом репозитории на Вашем компьютере должны быть установленны следущие программы:
* Виртуальная машина для запуска программ на Erlang (erl)
https://www.erlang.org/downloads
(в нижней части сайта есть подсказки, как скачать готовый бинарный файл для Linux и Mac OS X)
* Утилита Make, версии не ниже 4. Если Вы используете Mac OS X, то Вам следует скачать утилиту gmake и собирать код с помощью нее (для установки gmake рекомендуется использовать утилиту brew). 
Ссылка для установки make на Windows:
http://www.equation.com/servlet/equation.cmd?fa=make
* Sublime Text (или же любая IDE, поддерживающая Erlang). Sublime Text - это популярная программа для редактирования кода, не являющаяся при этом полноценной IDE, но предоставляющая при этом возможности подсветки синтаксиса кода на Erlang. В данном случае, полноценная IDE не нужна, так как сборка проекта производится с помощью специально подготовленного заранее MakeFile, а его запуск - всего одной командой из консоли.

##### Запуск проекта из репозитория:
Теперь для того чтобы проверить, что все этапы предварительной подготовки выполнены верно и Ваш компьютер подготовлен к запуску программ на Erlang, попробуем запустить код из этого репозитория. Для начала скачаем его в рабочую директорию, перейдя в нее из терминала и выполнив команду и, после выполним сборку проекта:
```sh
$ git clone https://github.com/taxarun/erlang_template_handler.git
$ make
```
Учтите, что если вы работаете на OS X, то вместо make следует выполнять gmake.
Теперь, в Вашей рабочей директории появилась новая папка, которая содержит в себе бинарный файл для выполнения в виртуальной машине erl. Теперь, чтобы выполнить его, нужно сначала из рабочей директории перейти к файлу и выполнить его со специальным параметром:
```sh
$ cd _rel/erlang_server/bin
$ ./erlang_server console
```
Если все прошло успешно, то можно открыть тестовую страничку, которую выдает сервер, прямо из браузера, введя следующий адрес:
http://localhost:8080/

##### Описание реализованного функционала в сервере:
В данном репозитории предоставляется базовый сервер, разработанный на языке Erlang. В текущей реализации его функционал заключается в том, что при запуске он открывает заранее подготовленный файл под названием index.html, который находится в папке static рабочей директории. Далее он начинает слушать порт 8080 и при любом запросе на него возвращает клиенту index.html, но, предварительно, изменив его. Суть в том, что в используемом index.html присутствуют некоторые шаблонные слова, которые требуется заменить перед отображением вэб страницы пользователю. Они выделяются специальным символом "Æ". В текущую версию сервера заложено условие заранее - менять шаблонное слово "username" на фразу "Unknown User". После завершения подмены программа удаляет из странички оставшиеся шаблонизирующие символы "Æ" и присылает полученную страницу клиенту, предварительно создав для нее заголовок ответа (responce header). Без этого заголовка невозможна корректная работа сервера с браузерами.

##### Прежде чем начать читать и писать код...
Для того, чтобы понять Erlang, предлагается прочесть данные материалы. Они помогут Вам понять идею самого языка, базовые типы, использемые в нем, а так же его дополнительные возможности.

* Описание типов данных
https://ru.hexlet.io/courses/erlang_101/lessons/practical_erlang_string/theory_unit
* Документация по стандартной библиотеке
http://erlang.org/doc/man/
* Самое важное здесь - pattern matching
https://habrahabr.ru/post/211815/
* Ответы на практически все вопросы (не надо читать заранее, слишком большой материал, но по мере надобности там можно найти почти все)
http://learnyousomeerlang.com/contents

##### Задача для реализации
В данной работе Вам придется внести изменения только в один из исходных файлов, а именно connection_protocol.erl, находящийся в папке src рабочей директории. Существующий сервер должен научиться обрабатывать POST запросы и подставлять значения переданных переменных в шаблон html странички. Если полученных переменных нет в шаблоне, то просто проигнорировать их и перед отправкой странички пользователю удалить из нее все шаблонизирующие символы. Рассмотрим по пунктам, что требует модификации:
* Требуется добавить еще одну фуекцию protocol, которая будет выполняться для POST запросов (как и уже существующие две она должна выбираться по принципу pattern matching). В этой фуекции следует производить анализ заголовка запроса на предмет наличия в нем передаваемых переменных. При их наличии создавать из них массив элементов {название переменной, ее значение}. 
Чтобы понять, как выглядит запрос и в каком виде в нем представлены переменные, Вы можете  раскомментировать специальную строку в программе (вы найдете ее по комментариям в коде). Тогда, в выводе сервера вы увидите приходящие на него запросы (вывод сервера пишется в то окно командной строки, из которого Вы запустили сервер). Чтобы увидеть пример POST запроса, нужно на стандартной страничке (которая по умолчанию поставляется в этом репозитории) ввести значение в любое из полей и нажать Enter.
* Далее Вам следует изменить функцию prepare_to_send таким образом, чтобы она принимала еще один параметр - массив элементов {название переменной, ее значение}, который составляется при POST запросе. 
Далее в этой функции следует итерироваться по вышеописанному массиву и искать имена переменных в шаблоне. Если они находятся, то заменять их на значение переменной (пример, как делать замену уже есть в коде и подписан комментарием). Учтите, что при GET запросе и при неизвестном запросе не надо пытаться делать замены, в данном коде это сделано для примера. 
Алгоритм подстановки шаблонных переменных было бы неплохо вынести в отдельную функцию.
* После корректной реализации обработчика POST запроса сделать так, чтобы сервер не отвечал на какие-либо запросы кроме GET и POST.

P.S. Одно из важнейших условий сдачи данной работы. Ваше решение не должно быть подогнано под html страничку в этом репозитории, программа должна работать с любой html страницей, в которой шаблонные слова обернуты символом "Æ".
P.P.S. Если Вы будете менять страничку html для проверки своего решения, то учтите, что с жесткого диска файл читается только при запуске сервера. Поэтому, чтобы отображалась измененная страничка, Вы должны перезапустить сервер.